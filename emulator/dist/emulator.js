parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"DZzW":[function(require,module,exports) {
"use strict";function t(t,e){const a=t.dataView.getUint16(93,!0);t.data[a]=255&t.pc,t.data[a-1]=t.pc>>8&255,t.pc22Bits&&(t.data[a-2]=t.pc>>16&255),t.dataView.setUint16(93,a-(t.pc22Bits?3:2),!0),t.data[95]&=127,t.cycles+=2,t.pc=e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.avrInterrupt=t;
},{}],"F3UQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CPU=void 0;var t=require("./interrupt");const e=256;class s{constructor(t,s=8192){this.progMem=t,this.sramBytes=s,this.data=new Uint8Array(this.sramBytes+e),this.data16=new Uint16Array(this.data.buffer),this.dataView=new DataView(this.data.buffer),this.progBytes=new Uint8Array(this.progMem.buffer),this.readHooks=[],this.writeHooks=[],this.pendingInterrupts=[],this.clockEvents=[],this.pc22Bits=this.progBytes.length>131072,this.gpioTimerHooks=[],this.pc=0,this.cycles=0,this.nextInterrupt=-1,this.nextClockEvent=0,this.reset()}reset(){this.data.fill(0),this.SP=this.data.length-1,this.pendingInterrupts.splice(0,this.pendingInterrupts.length),this.nextInterrupt=-1}readData(t){return t>=32&&this.readHooks[t]?this.readHooks[t](t):this.data[t]}writeData(t,e){const s=this.writeHooks[t];s&&s(e,this.data[t],t)||(this.data[t]=e)}get SP(){return this.dataView.getUint16(93,!0)}set SP(t){this.dataView.setUint16(93,t,!0)}get SREG(){return this.data[95]}get interruptsEnabled(){return!!(128&this.SREG)}updateNextInterrupt(){this.nextInterrupt=this.pendingInterrupts.findIndex(t=>!!t)}setInterruptFlag(t){const{flagRegister:e,flagMask:s,enableRegister:i,enableMask:r}=t;t.inverseFlag?this.data[e]&=~s:this.data[e]|=s,this.data[i]&r&&this.queueInterrupt(t)}updateInterruptEnable(t,e){const{enableMask:s,flagRegister:i,flagMask:r}=t;e&s?this.data[i]&r&&this.queueInterrupt(t):this.clearInterrupt(t,!1)}queueInterrupt(t){this.pendingInterrupts[t.address]=t,this.updateNextInterrupt()}clearInterrupt({address:t,flagRegister:e,flagMask:s},i=!0){delete this.pendingInterrupts[t],i&&(this.data[e]&=~s),this.updateNextInterrupt()}clearInterruptByFlag(t,e){const{flagRegister:s,flagMask:i}=t;e&i&&(this.data[s]&=~i,this.clearInterrupt(t))}addClockEvent(t,e){const s={cycles:this.cycles+Math.max(1,e),callback:t},{clockEvents:i}=this;if(!i.length||i[i.length-1].cycles<=s.cycles)i.push(s);else if(i[0].cycles>=s.cycles)i.unshift(s);else for(let r=1;r<i.length;r++)if(i[r].cycles>=s.cycles){i.splice(r,0,s);break}return this.nextClockEvent=this.clockEvents[0].cycles,t}updateClockEvent(t,e){return!!this.clearClockEvent(t)&&(this.addClockEvent(t,e),!0)}clearClockEvent(t){var e,s;const i=this.clockEvents.findIndex(e=>e.callback===t);return i>=0&&(this.clockEvents.splice(i,1),this.nextClockEvent=null!==(s=null===(e=this.clockEvents[0])||void 0===e?void 0:e.cycles)&&void 0!==s?s:0,!0)}tick(){var e,s,i;const{nextClockEvent:r,clockEvents:n}=this;r&&r<=this.cycles&&(null===(e=n.shift())||void 0===e||e.callback(),this.nextClockEvent=null!==(i=null===(s=n[0])||void 0===s?void 0:s.cycles)&&void 0!==i?i:0);const{nextInterrupt:a}=this;if(this.interruptsEnabled&&a>=0){const e=this.pendingInterrupts[a];(0,t.avrInterrupt)(this,e.address),e.constant||this.clearInterrupt(e)}}}exports.CPU=s;
},{"./interrupt":"DZzW"}],"cvTP":[function(require,module,exports) {
"use strict";function a(a){return 36864==(65039&a)||37376==(65039&a)||37902==(65038&a)||37900==(65038&a)}function t(t){const e=t.progMem[t.pc];if(7168==(64512&e)){const a=t.data[(496&e)>>4],d=t.data[15&e|(512&e)>>5],i=a+d+(1&t.data[95]),s=255&i;t.data[(496&e)>>4]=s;let c=192&t.data[95];c|=s?0:2,c|=128&s?4:0,c|=(s^d)&(a^s)&128?8:0,c|=c>>2&1^c>>3&1?16:0,c|=256&i?1:0,c|=1&(a&d|d&~s|~s&a)?32:0,t.data[95]=c}else if(3072==(64512&e)){const a=t.data[(496&e)>>4],d=t.data[15&e|(512&e)>>5],i=a+d&255;t.data[(496&e)>>4]=i;let s=192&t.data[95];s|=i?0:2,s|=128&i?4:0,s|=(i^d)&(i^a)&128?8:0,s|=s>>2&1^s>>3&1?16:0,s|=a+d&256?1:0,s|=1&(a&d|d&~i|~i&a)?32:0,t.data[95]=s}else if(38400==(65280&e)){const a=2*((48&e)>>4)+24,d=t.dataView.getUint16(a,!0),i=d+(15&e|(192&e)>>2)&65535;t.dataView.setUint16(a,i,!0);let s=224&t.data[95];s|=i?0:2,s|=32768&i?4:0,s|=~d&i&32768?8:0,s|=s>>2&1^s>>3&1?16:0,s|=~i&d&32768?1:0,t.data[95]=s,t.cycles++}else if(8192==(64512&e)){const a=t.data[(496&e)>>4]&t.data[15&e|(512&e)>>5];t.data[(496&e)>>4]=a;let d=225&t.data[95];d|=a?0:2,d|=128&a?4:0,d|=d>>2&1^d>>3&1?16:0,t.data[95]=d}else if(28672==(61440&e)){const a=t.data[16+((240&e)>>4)]&(15&e|(3840&e)>>4);t.data[16+((240&e)>>4)]=a;let d=225&t.data[95];d|=a?0:2,d|=128&a?4:0,d|=d>>2&1^d>>3&1?16:0,t.data[95]=d}else if(37893==(65039&e)){const a=t.data[(496&e)>>4],d=a>>>1|128&a;t.data[(496&e)>>4]=d;let i=224&t.data[95];i|=d?0:2,i|=128&d?4:0,i|=1&a,i|=i>>2&1^1&i?8:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if(38024==(65423&e))t.data[95]&=~(1<<((112&e)>>4));else if(63488==(65032&e)){const a=7&e,d=(496&e)>>4;t.data[d]=~(1<<a)&t.data[d]|(t.data[95]>>6&1)<<a}else if(62464==(64512&e))t.data[95]&1<<(7&e)||(t.pc=t.pc+(((504&e)>>3)-(512&e?64:0)),t.cycles++);else if(61440==(64512&e))t.data[95]&1<<(7&e)&&(t.pc=t.pc+(((504&e)>>3)-(512&e?64:0)),t.cycles++);else if(37896==(65423&e))t.data[95]|=1<<((112&e)>>4);else if(64e3==(65032&e)){const a=t.data[(496&e)>>4],d=7&e;t.data[95]=191&t.data[95]|(a>>d&1?64:0)}else if(37902==(65038&e)){const a=t.progMem[t.pc+1]|(1&e)<<16|(496&e)<<13,d=t.pc+2,i=t.dataView.getUint16(93,!0),{pc22Bits:s}=t;t.data[i]=255&d,t.data[i-1]=d>>8&255,s&&(t.data[i-2]=d>>16&255),t.dataView.setUint16(93,i-(s?3:2),!0),t.pc=a-1,t.cycles+=s?4:3}else if(38912==(65280&e)){const a=248&e,d=7&e,i=t.readData(32+(a>>3));t.writeData(32+(a>>3),i&~(1<<d))}else if(37888==(65039&e)){const a=(496&e)>>4,d=255-t.data[a];t.data[a]=d;let i=225&t.data[95]|1;i|=d?0:2,i|=128&d?4:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if(5120==(64512&e)){const a=t.data[(496&e)>>4],d=t.data[15&e|(512&e)>>5],i=a-d;let s=192&t.data[95];s|=i?0:2,s|=128&i?4:0,s|=0!=((a^d)&(a^i)&128)?8:0,s|=s>>2&1^s>>3&1?16:0,s|=d>a?1:0,s|=1&(~a&d|d&i|i&~a)?32:0,t.data[95]=s}else if(1024==(64512&e)){const a=t.data[(496&e)>>4],d=t.data[15&e|(512&e)>>5];let i=t.data[95];const s=a-d-(1&i);i=192&i|(!s&&i>>1&1?2:0)|(d+(1&i)>a?1:0),i|=128&s?4:0,i|=(a^d)&(a^s)&128?8:0,i|=i>>2&1^i>>3&1?16:0,i|=1&(~a&d|d&s|s&~a)?32:0,t.data[95]=i}else if(12288==(61440&e)){const a=t.data[16+((240&e)>>4)],d=15&e|(3840&e)>>4,i=a-d;let s=192&t.data[95];s|=i?0:2,s|=128&i?4:0,s|=(a^d)&(a^i)&128?8:0,s|=s>>2&1^s>>3&1?16:0,s|=d>a?1:0,s|=1&(~a&d|d&i|i&~a)?32:0,t.data[95]=s}else if(4096==(64512&e)){if(t.data[(496&e)>>4]===t.data[15&e|(512&e)>>5]){const e=a(t.progMem[t.pc+1])?2:1;t.pc+=e,t.cycles+=e}}else if(37898==(65039&e)){const a=t.data[(496&e)>>4],d=a-1;t.data[(496&e)>>4]=d;let i=225&t.data[95];i|=d?0:2,i|=128&d?4:0,i|=128===a?8:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if(38169===e){const a=t.pc+1,e=t.dataView.getUint16(93,!0),d=t.data[92];t.data[e]=255&a,t.data[e-1]=a>>8&255,t.data[e-2]=a>>16&255,t.dataView.setUint16(93,e-3,!0),t.pc=(d<<16|t.dataView.getUint16(30,!0))-1,t.cycles+=3}else if(37913===e){const a=t.data[92];t.pc=(a<<16|t.dataView.getUint16(30,!0))-1,t.cycles++}else if(38360===e){const a=t.data[91];t.data[0]=t.progBytes[a<<16|t.dataView.getUint16(30,!0)],t.cycles+=2}else if(36870==(65039&e)){const a=t.data[91];t.data[(496&e)>>4]=t.progBytes[a<<16|t.dataView.getUint16(30,!0)],t.cycles+=2}else if(36871==(65039&e)){const a=t.data[91],d=t.dataView.getUint16(30,!0);t.data[(496&e)>>4]=t.progBytes[a<<16|d],t.dataView.setUint16(30,d+1,!0),65535===d&&(t.data[91]=(a+1)%(t.progBytes.length>>16)),t.cycles+=2}else if(9216==(64512&e)){const a=t.data[(496&e)>>4]^t.data[15&e|(512&e)>>5];t.data[(496&e)>>4]=a;let d=225&t.data[95];d|=a?0:2,d|=128&a?4:0,d|=d>>2&1^d>>3&1?16:0,t.data[95]=d}else if(776==(65416&e)){const a=t.data[16+((112&e)>>4)],d=t.data[16+(7&e)],i=a*d<<1;t.dataView.setUint16(0,i,!0),t.data[95]=252&t.data[95]|(65535&i?0:2)|(a*d&32768?1:0),t.cycles++}else if(896==(65416&e)){const a=t.dataView.getInt8(16+((112&e)>>4)),d=t.dataView.getInt8(16+(7&e)),i=a*d<<1;t.dataView.setInt16(0,i,!0),t.data[95]=252&t.data[95]|(65535&i?0:2)|(a*d&32768?1:0),t.cycles++}else if(904==(65416&e)){const a=t.dataView.getInt8(16+((112&e)>>4)),d=t.data[16+(7&e)],i=a*d<<1;t.dataView.setInt16(0,i,!0),t.data[95]=252&t.data[95]|(65535&i?2:0)|(a*d&32768?1:0),t.cycles++}else if(38153===e){const a=t.pc+1,e=t.dataView.getUint16(93,!0),{pc22Bits:d}=t;t.data[e]=255&a,t.data[e-1]=a>>8&255,d&&(t.data[e-2]=a>>16&255),t.dataView.setUint16(93,e-(d?3:2),!0),t.pc=t.dataView.getUint16(30,!0)-1,t.cycles+=d?3:2}else if(37897===e)t.pc=t.dataView.getUint16(30,!0)-1,t.cycles++;else if(45056==(63488&e)){const a=t.readData(32+(15&e|(1536&e)>>5));t.data[(496&e)>>4]=a}else if(37891==(65039&e)){const a=t.data[(496&e)>>4],d=a+1&255;t.data[(496&e)>>4]=d;let i=225&t.data[95];i|=d?0:2,i|=128&d?4:0,i|=127===a?8:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if(37900==(65038&e))t.pc=(t.progMem[t.pc+1]|(1&e)<<16|(496&e)<<13)-1,t.cycles+=2;else if(37382==(65039&e)){const a=(496&e)>>4,d=t.data[a],i=t.readData(t.dataView.getUint16(30,!0));t.writeData(t.dataView.getUint16(30,!0),i&255-d),t.data[a]=i}else if(37381==(65039&e)){const a=(496&e)>>4,d=t.data[a],i=t.readData(t.dataView.getUint16(30,!0));t.writeData(t.dataView.getUint16(30,!0),i|d),t.data[a]=i}else if(37383==(65039&e)){const a=t.data[(496&e)>>4],d=t.readData(t.dataView.getUint16(30,!0));t.writeData(t.dataView.getUint16(30,!0),a^d),t.data[(496&e)>>4]=d}else if(57344==(61440&e))t.data[16+((240&e)>>4)]=15&e|(3840&e)>>4;else if(36864==(65039&e)){t.cycles++;const a=t.readData(t.progMem[t.pc+1]);t.data[(496&e)>>4]=a,t.pc++}else if(36876==(65039&e))t.cycles++,t.data[(496&e)>>4]=t.readData(t.dataView.getUint16(26,!0));else if(36877==(65039&e)){const a=t.dataView.getUint16(26,!0);t.cycles++,t.data[(496&e)>>4]=t.readData(a),t.dataView.setUint16(26,a+1,!0)}else if(36878==(65039&e)){const a=t.dataView.getUint16(26,!0)-1;t.dataView.setUint16(26,a,!0),t.cycles++,t.data[(496&e)>>4]=t.readData(a)}else if(32776==(65039&e))t.cycles++,t.data[(496&e)>>4]=t.readData(t.dataView.getUint16(28,!0));else if(36873==(65039&e)){const a=t.dataView.getUint16(28,!0);t.cycles++,t.data[(496&e)>>4]=t.readData(a),t.dataView.setUint16(28,a+1,!0)}else if(36874==(65039&e)){const a=t.dataView.getUint16(28,!0)-1;t.dataView.setUint16(28,a,!0),t.cycles++,t.data[(496&e)>>4]=t.readData(a)}else if(32776==(53768&e)&&7&e|(3072&e)>>7|(8192&e)>>8)t.cycles++,t.data[(496&e)>>4]=t.readData(t.dataView.getUint16(28,!0)+(7&e|(3072&e)>>7|(8192&e)>>8));else if(32768==(65039&e))t.cycles++,t.data[(496&e)>>4]=t.readData(t.dataView.getUint16(30,!0));else if(36865==(65039&e)){const a=t.dataView.getUint16(30,!0);t.cycles++,t.data[(496&e)>>4]=t.readData(a),t.dataView.setUint16(30,a+1,!0)}else if(36866==(65039&e)){const a=t.dataView.getUint16(30,!0)-1;t.dataView.setUint16(30,a,!0),t.cycles++,t.data[(496&e)>>4]=t.readData(a)}else if(32768==(53768&e)&&7&e|(3072&e)>>7|(8192&e)>>8)t.cycles++,t.data[(496&e)>>4]=t.readData(t.dataView.getUint16(30,!0)+(7&e|(3072&e)>>7|(8192&e)>>8));else if(38344===e)t.data[0]=t.progBytes[t.dataView.getUint16(30,!0)],t.cycles+=2;else if(36868==(65039&e))t.data[(496&e)>>4]=t.progBytes[t.dataView.getUint16(30,!0)],t.cycles+=2;else if(36869==(65039&e)){const a=t.dataView.getUint16(30,!0);t.data[(496&e)>>4]=t.progBytes[a],t.dataView.setUint16(30,a+1,!0),t.cycles+=2}else if(37894==(65039&e)){const a=t.data[(496&e)>>4],d=a>>>1;t.data[(496&e)>>4]=d;let i=224&t.data[95];i|=d?0:2,i|=1&a,i|=i>>2&1^1&i?8:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if(11264==(64512&e))t.data[(496&e)>>4]=t.data[15&e|(512&e)>>5];else if(256==(65280&e)){const a=2*(15&e),d=2*((240&e)>>4);t.data[d]=t.data[a],t.data[d+1]=t.data[a+1]}else if(39936==(64512&e)){const a=t.data[(496&e)>>4]*t.data[15&e|(512&e)>>5];t.dataView.setUint16(0,a,!0),t.data[95]=252&t.data[95]|(65535&a?0:2)|(32768&a?1:0),t.cycles++}else if(512==(65280&e)){const a=t.dataView.getInt8(16+((240&e)>>4))*t.dataView.getInt8(16+(15&e));t.dataView.setInt16(0,a,!0),t.data[95]=252&t.data[95]|(65535&a?0:2)|(32768&a?1:0),t.cycles++}else if(768==(65416&e)){const a=t.dataView.getInt8(16+((112&e)>>4))*t.data[16+(7&e)];t.dataView.setInt16(0,a,!0),t.data[95]=252&t.data[95]|(65535&a?0:2)|(32768&a?1:0),t.cycles++}else if(37889==(65039&e)){const a=(496&e)>>4,d=t.data[a],i=0-d;t.data[a]=i;let s=192&t.data[95];s|=i?0:2,s|=128&i?4:0,s|=128===i?8:0,s|=s>>2&1^s>>3&1?16:0,s|=i?1:0,s|=1&(i|d)?32:0,t.data[95]=s}else if(0===e);else if(10240==(64512&e)){const a=t.data[(496&e)>>4]|t.data[15&e|(512&e)>>5];t.data[(496&e)>>4]=a;let d=225&t.data[95];d|=a?0:2,d|=128&a?4:0,d|=d>>2&1^d>>3&1?16:0,t.data[95]=d}else if(24576==(61440&e)){const a=t.data[16+((240&e)>>4)]|15&e|(3840&e)>>4;t.data[16+((240&e)>>4)]=a;let d=225&t.data[95];d|=a?0:2,d|=128&a?4:0,d|=d>>2&1^d>>3&1?16:0,t.data[95]=d}else if(47104==(63488&e))t.writeData(32+(15&e|(1536&e)>>5),t.data[(496&e)>>4]);else if(36879==(65039&e)){const a=t.dataView.getUint16(93,!0)+1;t.dataView.setUint16(93,a,!0),t.data[(496&e)>>4]=t.data[a],t.cycles++}else if(37391==(65039&e)){const a=t.dataView.getUint16(93,!0);t.data[a]=t.data[(496&e)>>4],t.dataView.setUint16(93,a-1,!0),t.cycles++}else if(53248==(61440&e)){const a=(2047&e)-(2048&e?2048:0),d=t.pc+1,i=t.dataView.getUint16(93,!0),{pc22Bits:s}=t;t.data[i]=255&d,t.data[i-1]=d>>8&255,s&&(t.data[i-2]=d>>16&255),t.dataView.setUint16(93,i-(s?3:2),!0),t.pc+=a,t.cycles+=s?3:2}else if(38152===e){const{pc22Bits:a}=t,e=t.dataView.getUint16(93,!0)+(a?3:2);t.dataView.setUint16(93,e,!0),t.pc=(t.data[e-1]<<8)+t.data[e]-1,a&&(t.pc|=t.data[e-2]<<16),t.cycles+=a?4:3}else if(38168===e){const{pc22Bits:a}=t,e=t.dataView.getUint16(93,!0)+(a?3:2);t.dataView.setUint16(93,e,!0),t.pc=(t.data[e-1]<<8)+t.data[e]-1,a&&(t.pc|=t.data[e-2]<<16),t.cycles+=a?4:3,t.data[95]|=128}else if(49152==(61440&e))t.pc=t.pc+((2047&e)-(2048&e?2048:0)),t.cycles++;else if(37895==(65039&e)){const a=t.data[(496&e)>>4],d=a>>>1|(1&t.data[95])<<7;t.data[(496&e)>>4]=d;let i=224&t.data[95];i|=d?0:2,i|=128&d?4:0,i|=1&a?1:0,i|=i>>2&1^1&i?8:0,i|=i>>2&1^i>>3&1?16:0,t.data[95]=i}else if(2048==(64512&e)){const a=t.data[(496&e)>>4],d=t.data[15&e|(512&e)>>5];let i=t.data[95];const s=a-d-(1&i);t.data[(496&e)>>4]=s,i=192&i|(!s&&i>>1&1?2:0)|(d+(1&i)>a?1:0),i|=128&s?4:0,i|=(a^d)&(a^s)&128?8:0,i|=i>>2&1^i>>3&1?16:0,i|=1&(~a&d|d&s|s&~a)?32:0,t.data[95]=i}else if(16384==(61440&e)){const a=t.data[16+((240&e)>>4)],d=15&e|(3840&e)>>4;let i=t.data[95];const s=a-d-(1&i);t.data[16+((240&e)>>4)]=s,i=192&i|(!s&&i>>1&1?2:0)|(d+(1&i)>a?1:0),i|=128&s?4:0,i|=(a^d)&(a^s)&128?8:0,i|=i>>2&1^i>>3&1?16:0,i|=1&(~a&d|d&s|s&~a)?32:0,t.data[95]=i}else if(39424==(65280&e)){const a=32+((248&e)>>3);t.writeData(a,t.readData(a)|1<<(7&e)),t.cycles++}else if(39168==(65280&e)){if(!(t.readData(32+((248&e)>>3))&1<<(7&e))){const e=a(t.progMem[t.pc+1])?2:1;t.cycles+=e,t.pc+=e}}else if(39680==(65280&e)){if(t.readData(32+((248&e)>>3))&1<<(7&e)){const e=a(t.progMem[t.pc+1])?2:1;t.cycles+=e,t.pc+=e}}else if(38656==(65280&e)){const a=2*((48&e)>>4)+24,d=t.dataView.getUint16(a,!0),i=15&e|(192&e)>>2,s=d-i;t.dataView.setUint16(a,s,!0);let c=192&t.data[95];c|=s?0:2,c|=32768&s?4:0,c|=d&~s&32768?8:0,c|=c>>2&1^c>>3&1?16:0,c|=i>d?1:0,c|=1&(~d&i|i&s|s&~d)?32:0,t.data[95]=c,t.cycles++}else if(64512==(65032&e)){if(!(t.data[(496&e)>>4]&1<<(7&e))){const e=a(t.progMem[t.pc+1])?2:1;t.cycles+=e,t.pc+=e}}else if(65024==(65032&e)){if(t.data[(496&e)>>4]&1<<(7&e)){const e=a(t.progMem[t.pc+1])?2:1;t.cycles+=e,t.pc+=e}}else if(38280===e);else if(38376===e);else if(38392===e);else if(37376==(65039&e)){const a=t.data[(496&e)>>4],d=t.progMem[t.pc+1];t.writeData(d,a),t.pc++,t.cycles++}else if(37388==(65039&e))t.writeData(t.dataView.getUint16(26,!0),t.data[(496&e)>>4]),t.cycles++;else if(37389==(65039&e)){const a=t.dataView.getUint16(26,!0);t.writeData(a,t.data[(496&e)>>4]),t.dataView.setUint16(26,a+1,!0),t.cycles++}else if(37390==(65039&e)){const a=t.data[(496&e)>>4],d=t.dataView.getUint16(26,!0)-1;t.dataView.setUint16(26,d,!0),t.writeData(d,a),t.cycles++}else if(33288==(65039&e))t.writeData(t.dataView.getUint16(28,!0),t.data[(496&e)>>4]),t.cycles++;else if(37385==(65039&e)){const a=t.data[(496&e)>>4],d=t.dataView.getUint16(28,!0);t.writeData(d,a),t.dataView.setUint16(28,d+1,!0),t.cycles++}else if(37386==(65039&e)){const a=t.data[(496&e)>>4],d=t.dataView.getUint16(28,!0)-1;t.dataView.setUint16(28,d,!0),t.writeData(d,a),t.cycles++}else if(33288==(53768&e)&&7&e|(3072&e)>>7|(8192&e)>>8)t.writeData(t.dataView.getUint16(28,!0)+(7&e|(3072&e)>>7|(8192&e)>>8),t.data[(496&e)>>4]),t.cycles++;else if(33280==(65039&e))t.writeData(t.dataView.getUint16(30,!0),t.data[(496&e)>>4]),t.cycles++;else if(37377==(65039&e)){const a=t.dataView.getUint16(30,!0);t.writeData(a,t.data[(496&e)>>4]),t.dataView.setUint16(30,a+1,!0),t.cycles++}else if(37378==(65039&e)){const a=t.data[(496&e)>>4],d=t.dataView.getUint16(30,!0)-1;t.dataView.setUint16(30,d,!0),t.writeData(d,a),t.cycles++}else if(33280==(53768&e)&&7&e|(3072&e)>>7|(8192&e)>>8)t.writeData(t.dataView.getUint16(30,!0)+(7&e|(3072&e)>>7|(8192&e)>>8),t.data[(496&e)>>4]),t.cycles++;else if(6144==(64512&e)){const a=t.data[(496&e)>>4],d=t.data[15&e|(512&e)>>5],i=a-d;t.data[(496&e)>>4]=i;let s=192&t.data[95];s|=i?0:2,s|=128&i?4:0,s|=(a^d)&(a^i)&128?8:0,s|=s>>2&1^s>>3&1?16:0,s|=d>a?1:0,s|=1&(~a&d|d&i|i&~a)?32:0,t.data[95]=s}else if(20480==(61440&e)){const a=t.data[16+((240&e)>>4)],d=15&e|(3840&e)>>4,i=a-d;t.data[16+((240&e)>>4)]=i;let s=192&t.data[95];s|=i?0:2,s|=128&i?4:0,s|=(a^d)&(a^i)&128?8:0,s|=s>>2&1^s>>3&1?16:0,s|=d>a?1:0,s|=1&(~a&d|d&i|i&~a)?32:0,t.data[95]=s}else if(37890==(65039&e)){const a=(496&e)>>4,d=t.data[a];t.data[a]=(15&d)<<4|(240&d)>>>4}else if(38312===e);else if(37380==(65039&e)){const a=(496&e)>>4,d=t.data[a],i=t.data[t.dataView.getUint16(30,!0)];t.data[t.dataView.getUint16(30,!0)]=d,t.data[a]=i}t.pc=(t.pc+1)%t.progMem.length,t.cycles++}Object.defineProperty(exports,"__esModule",{value:!0}),exports.avrInstruction=t;
},{}],"X0BL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AVRIOPort=exports.PinOverrideMode=exports.PinState=exports.portLConfig=exports.portKConfig=exports.portJConfig=exports.portHConfig=exports.portGConfig=exports.portFConfig=exports.portEConfig=exports.portDConfig=exports.portCConfig=exports.portBConfig=exports.portAConfig=void 0;const t={PIN:32,DDR:33,PORT:34};exports.portAConfig=t;const o={PIN:35,DDR:36,PORT:37};exports.portBConfig=o;const e={PIN:38,DDR:39,PORT:40};exports.portCConfig=e;const i={PIN:41,DDR:42,PORT:43};exports.portDConfig=i;const s={PIN:44,DDR:45,PORT:46};exports.portEConfig=s;const r={PIN:47,DDR:48,PORT:49};exports.portFConfig=r;const n={PIN:50,DDR:51,PORT:52};exports.portGConfig=n;const p={PIN:256,DDR:257,PORT:258};exports.portHConfig=p;const a={PIN:259,DDR:260,PORT:261};exports.portJConfig=a;const P={PIN:262,DDR:263,PORT:264};exports.portKConfig=P;const h={PIN:265,DDR:266,PORT:267};var l,d;exports.portLConfig=h,exports.PinState=l,function(t){t[t.Low=0]="Low",t[t.High=1]="High",t[t.Input=2]="Input",t[t.InputPullUp=3]="InputPullUp"}(l||(exports.PinState=l={})),exports.PinOverrideMode=d,function(t){t[t.None=0]="None",t[t.Enable=1]="Enable",t[t.Set=2]="Set",t[t.Clear=3]="Clear",t[t.Toggle=4]="Toggle"}(d||(exports.PinOverrideMode=d={}));class R{constructor(t,o){this.cpu=t,this.portConfig=o,this.listeners=[],this.pinValue=0,this.overrideMask=255,this.lastValue=0,this.lastDdr=0,t.writeHooks[o.DDR]=(e=>{const i=t.data[o.PORT];return t.data[o.DDR]=e,this.updatePinRegister(i,e),this.writeGpio(i,e),!0}),t.writeHooks[o.PORT]=(e=>{const i=t.data[o.DDR];return t.data[o.PORT]=e,this.updatePinRegister(e,i),this.writeGpio(e,i),!0}),t.writeHooks[o.PIN]=(e=>{const i=t.data[o.PORT],s=t.data[o.DDR],r=i^e;return t.data[o.PORT]=r,t.data[o.PIN]=t.data[o.PIN]&~s|r&s,this.writeGpio(r,s),!0}),t.gpioTimerHooks[o.PORT]=((e,i)=>{const s=1<<e;if(i==d.None)this.overrideMask|=s;else switch(this.overrideMask&=~s,i){case d.Enable:this.overrideValue&=~s,this.overrideValue|=t.data[o.PORT]&s;break;case d.Set:this.overrideValue|=s;break;case d.Clear:this.overrideValue&=~s;break;case d.Toggle:this.overrideValue^=s}this.writeGpio(t.data[o.PORT],t.data[o.DDR])})}addListener(t){this.listeners.push(t)}removeListener(t){this.listeners=this.listeners.filter(o=>o!==t)}pinState(t){const o=this.cpu.data[this.portConfig.DDR],e=this.cpu.data[this.portConfig.PORT],i=1<<t;return o&i?this.lastValue&i?l.High:l.Low:e&i?l.InputPullUp:l.Input}setPin(t,o){const e=1<<t;this.pinValue&=~e,o&&(this.pinValue|=e),this.updatePinRegister(this.cpu.data[this.portConfig.PORT],this.cpu.data[this.portConfig.DDR])}updatePinRegister(t,o){this.cpu.data[this.portConfig.PIN]=this.pinValue&~o|t&o}writeGpio(t,o){const e=(t&this.overrideMask|this.overrideValue)&o|t&~o,i=this.lastValue;if(e!==i||o!==this.lastDdr){this.lastValue=e,this.lastDdr=o;for(const t of this.listeners)t(e,i)}}}exports.AVRIOPort=R;
},{}],"eu9G":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AVRTimer=exports.timer2Config=exports.timer1Config=exports.timer0Config=void 0;var t=require("./gpio");const i={0:0,1:1,2:8,3:64,4:256,5:1024,6:0,7:0},e={TOV:1,OCFA:2,OCFB:4,TOIE:1,OCIEA:2,OCIEB:4},o=Object.assign({bits:8,captureInterrupt:0,compAInterrupt:28,compBInterrupt:30,ovfInterrupt:32,TIFR:53,OCRA:71,OCRB:72,ICR:0,TCNT:70,TCCRA:68,TCCRB:69,TCCRC:0,TIMSK:110,dividers:i,compPortA:t.portDConfig.PORT,compPinA:6,compPortB:t.portDConfig.PORT,compPinB:5},e);exports.timer0Config=o;const s=Object.assign({bits:16,captureInterrupt:20,compAInterrupt:22,compBInterrupt:24,ovfInterrupt:26,TIFR:54,OCRA:136,OCRB:138,ICR:134,TCNT:132,TCCRA:128,TCCRB:129,TCCRC:130,TIMSK:111,dividers:i,compPortA:t.portBConfig.PORT,compPinA:1,compPortB:t.portBConfig.PORT,compPinB:2},e);exports.timer1Config=s;const r=Object.assign({bits:8,captureInterrupt:0,compAInterrupt:14,compBInterrupt:16,ovfInterrupt:18,TIFR:55,OCRA:179,OCRB:180,ICR:0,TCNT:178,TCCRA:176,TCCRB:177,TCCRC:0,TIMSK:112,dividers:{0:0,1:1,2:8,3:32,4:64,5:128,6:256,7:1024},compPortA:t.portBConfig.PORT,compPinA:3,compPortB:t.portDConfig.PORT,compPinB:3},e);var c,h,n;exports.timer2Config=r,function(t){t[t.Normal=0]="Normal",t[t.PWMPhaseCorrect=1]="PWMPhaseCorrect",t[t.CTC=2]="CTC",t[t.FastPWM=3]="FastPWM",t[t.PWMPhaseFrequencyCorrect=4]="PWMPhaseFrequencyCorrect",t[t.Reserved=5]="Reserved"}(c||(c={})),function(t){t[t.Max=0]="Max",t[t.Top=1]="Top",t[t.Bottom=2]="Bottom"}(h||(h={})),function(t){t[t.Immediate=0]="Immediate",t[t.Top=1]="Top",t[t.Bottom=2]="Bottom"}(n||(n={}));const p=1,a=2,d=1,{Normal:C,PWMPhaseCorrect:u,CTC:m,FastPWM:B,Reserved:T,PWMPhaseFrequencyCorrect:g}=c,O=[[C,255,n.Immediate,h.Max,0],[u,255,n.Top,h.Bottom,0],[m,p,n.Immediate,h.Max,0],[B,255,n.Bottom,h.Max,0],[T,255,n.Immediate,h.Max,0],[u,p,n.Top,h.Bottom,d],[T,255,n.Immediate,h.Max,0],[B,p,n.Bottom,h.Top,d]],M=[[C,65535,n.Immediate,h.Max,0],[u,255,n.Top,h.Bottom,0],[u,511,n.Top,h.Bottom,0],[u,1023,n.Top,h.Bottom,0],[m,p,n.Immediate,h.Max,0],[B,255,n.Bottom,h.Top,0],[B,511,n.Bottom,h.Top,0],[B,1023,n.Bottom,h.Top,0],[g,a,n.Bottom,h.Bottom,0],[g,p,n.Bottom,h.Bottom,d],[u,a,n.Top,h.Bottom,0],[u,p,n.Top,h.Bottom,d],[m,a,n.Immediate,h.Max,0],[T,65535,n.Immediate,h.Max,0],[B,a,n.Bottom,h.Top,d],[B,p,n.Bottom,h.Top,d]];function l(i){switch(i){case 1:return t.PinOverrideMode.Toggle;case 2:return t.PinOverrideMode.Clear;case 3:return t.PinOverrideMode.Set;default:return t.PinOverrideMode.Enable}}class A{constructor(t,i){if(this.cpu=t,this.config=i,this.MAX=16===this.config.bits?65535:255,this.lastCycle=0,this.ocrA=0,this.nextOcrA=0,this.ocrB=0,this.nextOcrB=0,this.ocrUpdateMode=n.Immediate,this.tovUpdateMode=h.Max,this.icr=0,this.tcnt=0,this.tcntNext=0,this.tcntUpdated=!1,this.updateDivider=!1,this.countingUp=!0,this.divider=0,this.highByteTemp=0,this.OVF={address:this.config.ovfInterrupt,flagRegister:this.config.TIFR,flagMask:this.config.TOV,enableRegister:this.config.TIMSK,enableMask:this.config.TOIE},this.OCFA={address:this.config.compAInterrupt,flagRegister:this.config.TIFR,flagMask:this.config.OCFA,enableRegister:this.config.TIMSK,enableMask:this.config.OCIEA},this.OCFB={address:this.config.compBInterrupt,flagRegister:this.config.TIFR,flagMask:this.config.OCFB,enableRegister:this.config.TIMSK,enableMask:this.config.OCIEB},this.count=((t=!0)=>{const{divider:i,lastCycle:e,cpu:o}=this,{cycles:s}=o,r=s-e;if(i&&r>=i){const t=Math.floor(r/i);this.lastCycle+=t*i;const e=this.tcnt,{timerMode:s,TOP:c}=this,p=s===u||s===g,a=p?this.phasePwmCount(e,t):(e+t)%(c+1),d=e+t>c;if(this.tcntUpdated||(this.tcnt=a,p||this.timerUpdated(a,e)),!p){if(s===B&&d){const{compA:t,compB:i}=this;t&&this.updateCompPin(t,"A",!0),i&&this.updateCompPin(i,"B",!0)}this.ocrUpdateMode==n.Bottom&&d&&(this.ocrA=this.nextOcrA,this.ocrB=this.nextOcrB),!d||this.tovUpdateMode!=h.Top&&c!==this.MAX||o.setInterruptFlag(this.OVF)}}if(this.tcntUpdated&&(this.tcnt=this.tcntNext,this.tcntUpdated=!1),this.updateDivider){const t=this.config.dividers[this.CS];return this.lastCycle=t?this.cpu.cycles:0,this.updateDivider=!1,this.divider=t,void(t&&o.addClockEvent(this.count,this.lastCycle+t-o.cycles))}t&&i&&o.addClockEvent(this.count,this.lastCycle+i-o.cycles)}),this.updateWGMConfig(),this.cpu.readHooks[i.TCNT]=(t=>(this.count(!1),16===this.config.bits&&(this.cpu.data[t+1]=this.tcnt>>8),this.cpu.data[t]=255&this.tcnt)),this.cpu.writeHooks[i.TCNT]=(t=>{this.tcntNext=this.highByteTemp<<8|t,this.countingUp=!0,this.tcntUpdated=!0,this.cpu.updateClockEvent(this.count,0),this.divider&&this.timerUpdated(this.tcntNext,this.tcntNext)}),this.cpu.writeHooks[i.OCRA]=(t=>{this.nextOcrA=this.highByteTemp<<8|t,this.ocrUpdateMode===n.Immediate&&(this.ocrA=this.nextOcrA)}),this.cpu.writeHooks[i.OCRB]=(t=>{this.nextOcrB=this.highByteTemp<<8|t,this.ocrUpdateMode===n.Immediate&&(this.ocrB=this.nextOcrB)}),this.cpu.writeHooks[i.ICR]=(t=>{this.icr=this.highByteTemp<<8|t}),16===this.config.bits){const t=t=>{this.highByteTemp=t};this.cpu.writeHooks[i.TCNT+1]=t,this.cpu.writeHooks[i.OCRA+1]=t,this.cpu.writeHooks[i.OCRB+1]=t,this.cpu.writeHooks[i.ICR+1]=t}t.writeHooks[i.TCCRA]=(t=>(this.cpu.data[i.TCCRA]=t,this.updateWGMConfig(),!0)),t.writeHooks[i.TCCRB]=(t=>(this.cpu.data[i.TCCRB]=t,this.updateDivider=!0,this.cpu.clearClockEvent(this.count),this.cpu.addClockEvent(this.count,0),this.updateWGMConfig(),!0)),t.writeHooks[i.TIFR]=(t=>(this.cpu.data[i.TIFR]=t,this.cpu.clearInterruptByFlag(this.OVF,t),this.cpu.clearInterruptByFlag(this.OCFA,t),this.cpu.clearInterruptByFlag(this.OCFB,t),!0)),t.writeHooks[i.TIMSK]=(t=>{this.cpu.updateInterruptEnable(this.OVF,t),this.cpu.updateInterruptEnable(this.OCFA,t),this.cpu.updateInterruptEnable(this.OCFB,t)})}reset(){this.divider=0,this.lastCycle=0,this.ocrA=0,this.nextOcrA=0,this.ocrB=0,this.nextOcrB=0,this.icr=0,this.tcnt=0,this.tcntNext=0,this.tcntUpdated=!1,this.countingUp=!1,this.updateDivider=!0}get TCCRA(){return this.cpu.data[this.config.TCCRA]}get TCCRB(){return this.cpu.data[this.config.TCCRB]}get TIMSK(){return this.cpu.data[this.config.TIMSK]}get CS(){return 7&this.TCCRB}get WGM(){const t=16===this.config.bits?24:8;return(this.TCCRB&t)>>1|3&this.TCCRA}get TOP(){switch(this.topValue){case p:return this.ocrA;case a:return this.icr;default:return this.topValue}}updateWGMConfig(){const{config:i,WGM:e}=this,o=16===i.bits?M:O,s=this.cpu.data[i.TCCRA],[r,c,h,n,p]=o[e];this.timerMode=r,this.topValue=c,this.ocrUpdateMode=h,this.tovUpdateMode=n;const a=r===B||r===u||r===g,C=this.compA;this.compA=s>>6&3,1!==this.compA||!a||p&d||(this.compA=0),!!C!=!!this.compA&&this.updateCompA(this.compA?t.PinOverrideMode.Enable:t.PinOverrideMode.None);const m=this.compB;this.compB=s>>4&3,1===this.compB&&a&&(this.compB=0),!!m!=!!this.compB&&this.updateCompB(this.compB?t.PinOverrideMode.Enable:t.PinOverrideMode.None)}phasePwmCount(t,i){const{ocrA:e,ocrB:o,TOP:s,tcntUpdated:r}=this;for(;i>0;)this.countingUp?++t!==s||r||(this.countingUp=!1,this.ocrUpdateMode===n.Top&&(this.ocrA=this.nextOcrA,this.ocrB=this.nextOcrB)):--t||r||(this.countingUp=!0,this.cpu.setInterruptFlag(this.OVF),this.ocrUpdateMode===n.Bottom&&(this.ocrA=this.nextOcrA,this.ocrB=this.nextOcrB)),r||t!==e||(this.cpu.setInterruptFlag(this.OCFA),this.compA&&this.updateCompPin(this.compA,"A")),r||t!==o||(this.cpu.setInterruptFlag(this.OCFB),this.compB&&this.updateCompPin(this.compB,"B")),i--;return t}timerUpdated(t,i){const{ocrA:e,ocrB:o}=this,s=i>t;(i<e||s)&&t>=e&&(this.cpu.setInterruptFlag(this.OCFA),this.compA&&this.updateCompPin(this.compA,"A")),(i<o||s)&&t>=o&&(this.cpu.setInterruptFlag(this.OCFB),this.compB&&this.updateCompPin(this.compB,"B"))}updateCompPin(i,e,o=!1){let s=t.PinOverrideMode.None;const r=3===i,c=this.countingUp===r;switch(this.timerMode){case C:case m:s=l(i);break;case B:s=1===i?o?t.PinOverrideMode.None:t.PinOverrideMode.Toggle:r!==o?t.PinOverrideMode.Set:t.PinOverrideMode.Clear;break;case u:case g:s=1===i?t.PinOverrideMode.Toggle:c?t.PinOverrideMode.Set:t.PinOverrideMode.Clear}s!==t.PinOverrideMode.None&&("A"===e?this.updateCompA(s):this.updateCompB(s))}updateCompA(t){const{compPortA:i,compPinA:e}=this.config,o=this.cpu.gpioTimerHooks[i];o&&o(e,t,i)}updateCompB(t){const{compPortB:i,compPinB:e}=this.config,o=this.cpu.gpioTimerHooks[i];o&&o(e,t,i)}}exports.AVRTimer=A;
},{"./gpio":"X0BL"}],"Iff3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AVRUSART=exports.usart0Config=void 0;const t={rxCompleteInterrupt:36,dataRegisterEmptyInterrupt:38,txCompleteInterrupt:40,UCSRA:192,UCSRB:193,UCSRC:194,UBRRL:196,UBRRH:197,UDR:198};exports.usart0Config=t;const e=128,s=64,i=32,r=16,a=8,n=4,h=2,u=1,c=128,o=64,l=32,p=16,R=8,C=4,g=2,f=1,d=128,B=64,U=32,y=16,S=8,x=4,m=2,I=1,b={5:31,6:63,7:127,8:255,9:255};class E{constructor(t,r,a){this.cpu=t,this.config=r,this.freqHz=a,this.onByteTransmit=null,this.onLineTransmit=null,this.onRxComplete=null,this.rxBusyValue=!1,this.rxByte=0,this.lineBuffer="",this.RXC={address:this.config.rxCompleteInterrupt,flagRegister:this.config.UCSRA,flagMask:e,enableRegister:this.config.UCSRB,enableMask:c,constant:!0},this.UDRE={address:this.config.dataRegisterEmptyInterrupt,flagRegister:this.config.UCSRA,flagMask:i,enableRegister:this.config.UCSRB,enableMask:l},this.TXC={address:this.config.txCompleteInterrupt,flagRegister:this.config.UCSRA,flagMask:s,enableRegister:this.config.UCSRB,enableMask:o},this.reset(),this.cpu.writeHooks[r.UCSRA]=(e=>(t.data[r.UCSRA]=e&(u|h),t.clearInterruptByFlag(this.TXC,e),!0)),this.cpu.writeHooks[r.UCSRB]=((e,s)=>{t.updateInterruptEnable(this.RXC,e),t.updateInterruptEnable(this.UDRE,e),t.updateInterruptEnable(this.TXC,e),e&p&&s&p&&t.clearInterrupt(this.RXC),e&R&&!(s&R)&&t.setInterruptFlag(this.UDRE)}),this.cpu.readHooks[r.UDR]=(()=>{var t;const e=null!==(t=b[this.bitsPerChar])&&void 0!==t?t:255,s=this.rxByte&e;return this.rxByte=0,this.cpu.clearInterrupt(this.RXC),s}),this.cpu.writeHooks[r.UDR]=(e=>{if(this.onByteTransmit&&this.onByteTransmit(e),this.onLineTransmit){const t=String.fromCharCode(e);"\n"===t?(this.onLineTransmit(this.lineBuffer),this.lineBuffer=""):this.lineBuffer+=t}this.cpu.addClockEvent(()=>{t.setInterruptFlag(this.UDRE),t.setInterruptFlag(this.TXC)},this.cyclesPerChar),this.cpu.clearInterrupt(this.TXC),this.cpu.clearInterrupt(this.UDRE)})}reset(){this.cpu.data[this.config.UCSRA]=i,this.cpu.data[this.config.UCSRB]=0,this.cpu.data[this.config.UCSRC]=x|m,this.rxBusyValue=!1,this.rxByte=0,this.lineBuffer=""}get rxBusy(){return this.rxBusyValue}writeByte(t){const{cpu:e,config:s}=this;return!(this.rxBusyValue||!(e.data[s.UCSRB]&p))&&(this.rxBusyValue=!0,e.addClockEvent(()=>{var s;this.rxByte=t,this.rxBusyValue=!1,e.setInterruptFlag(this.RXC),null===(s=this.onRxComplete)||void 0===s||s.call(this)},this.cyclesPerChar),!0)}get cyclesPerChar(){const t=1+this.bitsPerChar+this.stopBits+(this.parityEnabled?1:0);return(this.UBRR*this.multiplier+1)*t}get UBRR(){return this.cpu.data[this.config.UBRRH]<<8|this.cpu.data[this.config.UBRRL]}get multiplier(){return this.cpu.data[this.config.UCSRA]&h?8:16}get baudRate(){return Math.floor(this.freqHz/(this.multiplier*(1+this.UBRR)))}get bitsPerChar(){switch((this.cpu.data[this.config.UCSRC]&(x|m))>>1|this.cpu.data[this.config.UCSRB]&C){case 0:return 5;case 1:return 6;case 2:return 7;case 3:return 8;default:case 7:return 9}}get stopBits(){return this.cpu.data[this.config.UCSRC]&S?2:1}get parityEnabled(){return!!(this.cpu.data[this.config.UCSRC]&U)}get parityOdd(){return!!(this.cpu.data[this.config.UCSRC]&y)}}exports.AVRUSART=E;
},{}],"niNh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AVREEPROM=exports.eepromConfig=exports.EEPROMMemoryBackend=void 0;class e{constructor(e){this.memory=new Uint8Array(e),this.memory.fill(255)}readMemory(e){return this.memory[e]}writeMemory(e,t){this.memory[e]&=t}eraseMemory(e){this.memory[e]=255}}exports.EEPROMMemoryBackend=e;const t={eepromReadyInterrupt:44,EECR:63,EEDR:64,EEARL:65,EEARH:66,eraseCycles:28800,writeCycles:28800};exports.eepromConfig=t;const s=1,i=2,r=4,c=8,o=16,h=32;class a{constructor(e,a,n=t){this.cpu=e,this.backend=a,this.config=n,this.writeEnabledCycles=0,this.writeCompleteCycles=0,this.EER={address:this.config.eepromReadyInterrupt,flagRegister:this.config.EECR,flagMask:i,enableRegister:this.config.EECR,enableMask:c,constant:!0,inverseFlag:!0},this.cpu.writeHooks[this.config.EECR]=(e=>{const{EEARH:t,EEARL:c,EECR:a,EEDR:n}=this.config,l=this.cpu.data[t]<<8|this.cpu.data[c];if(e&s&&this.cpu.clearInterrupt(this.EER),e&r){const e=4;this.writeEnabledCycles=this.cpu.cycles+e,this.cpu.addClockEvent(()=>{this.cpu.data[a]&=~r},e)}if(e&s)return this.cpu.data[n]=this.backend.readMemory(l),this.cpu.cycles+=4,!0;if(e&i){if(this.cpu.cycles>=this.writeEnabledCycles)return!0;if(this.cpu.cycles<this.writeCompleteCycles)return!0;const t=this.cpu.data[n];return this.writeCompleteCycles=this.cpu.cycles,e&h||(this.backend.eraseMemory(l),this.writeCompleteCycles+=this.config.eraseCycles),e&o||(this.backend.writeMemory(l,t),this.writeCompleteCycles+=this.config.writeCycles),this.cpu.data[a]|=i,this.cpu.addClockEvent(()=>{this.cpu.setInterruptFlag(this.EER)},this.writeCompleteCycles-this.cpu.cycles),this.cpu.cycles+=2,!0}return!1})}}exports.AVREEPROM=a;
},{}],"PbiE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AVRTWI=exports.NoopTWIEventHandler=exports.twiConfig=void 0;const t=128,e=64,s=32,i=16,a=8,r=4,c=1,n=248,o=2,h=1,p=3,u=254,l=1,d=0,T=248,W=8,f=16,R=24,g=32,S=40,w=48,v=56,I=64,C=72,H=80,m=88,x={twiInterrupt:48,TWBR:184,TWSR:185,TWAR:186,TWDR:187,TWCR:188,TWAMR:189};exports.twiConfig=x;class y{constructor(t){this.twi=t}start(){this.twi.completeStart()}stop(){this.twi.completeStop()}connectToSlave(){this.twi.completeConnect(!1)}writeByte(){this.twi.completeWrite(!1)}readByte(){this.twi.completeRead(255)}}exports.NoopTWIEventHandler=y;class B{constructor(a,n,o){this.cpu=a,this.config=n,this.freqHz=o,this.eventHandler=new y(this),this.TWI={address:this.config.twiInterrupt,flagRegister:this.config.TWCR,flagMask:t,enableRegister:this.config.TWCR,enableMask:c},this.updateStatus(T),this.cpu.writeHooks[n.TWCR]=(a=>{this.cpu.data[n.TWCR]=a;const c=a&t;this.cpu.clearInterruptByFlag(this.TWI,a),this.cpu.updateInterruptEnable(this.TWI,a);const{status:o}=this;if(c&&a&r){const t=this.cpu.data[this.config.TWDR];return this.cpu.addClockEvent(()=>{if(a&s)this.eventHandler.start(o!==T);else if(a&i)this.eventHandler.stop();else if(o===W)this.eventHandler.connectToSlave(t>>1,!(1&t));else if(o===R||o===S)this.eventHandler.writeByte(t);else if(o===I||o===H){const t=!!(a&e);this.eventHandler.readByte(t)}},0),!0}})}get prescaler(){switch(this.cpu.data[this.config.TWSR]&p){case 0:return 1;case 1:return 4;case 2:return 16;case 3:return 64}throw new Error("Invalid prescaler value!")}get sclFrequency(){return this.freqHz/(16+2*this.cpu.data[this.config.TWBR]*this.prescaler)}completeStart(){this.updateStatus(this.status===T?W:f)}completeStop(){this.cpu.data[this.config.TWCR]&=~i,this.updateStatus(T)}completeConnect(t){1&this.cpu.data[this.config.TWDR]?this.updateStatus(t?I:C):this.updateStatus(t?R:g)}completeWrite(t){this.updateStatus(t?S:w)}completeRead(t){const s=!!(this.cpu.data[this.config.TWCR]&e);this.cpu.data[this.config.TWDR]=t,this.updateStatus(s?H:m)}get status(){return this.cpu.data[this.config.TWSR]&n}updateStatus(t){const{TWSR:e}=this.config;this.cpu.data[e]=this.cpu.data[e]&~n|t,this.cpu.setInterruptFlag(this.TWI)}}exports.AVRTWI=B;
},{}],"XwuY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AVRSPI=exports.spiConfig=void 0;const t=128,i=64,s=32,e=16,r=8,c=4,n=2,a=1,o=3,h=128,u=64,d=1,p={spiInterrupt:34,SPCR:76,SPSR:77,SPDR:78};exports.spiConfig=p;const l=8;class S{constructor(s,e,r){this.cpu=s,this.config=e,this.freqHz=r,this.onTransfer=null,this.transmissionActive=!1,this.receivedByte=0,this.SPI={address:this.config.spiInterrupt,flagRegister:this.config.SPSR,flagMask:h,enableRegister:this.config.SPCR,enableMask:t};const{SPCR:c,SPSR:n,SPDR:a}=e;s.writeHooks[a]=(t=>{var e,r;if(!(s.data[c]&i))return;if(this.transmissionActive)return s.data[n]|=u,!0;s.data[n]&=~u,this.cpu.clearInterrupt(this.SPI),this.receivedByte=null!==(r=null===(e=this.onTransfer)||void 0===e?void 0:e.call(this,t))&&void 0!==r?r:0;const o=this.clockDivider*l;return this.transmissionActive=!0,this.cpu.addClockEvent(()=>{this.cpu.data[a]=this.receivedByte,this.cpu.setInterruptFlag(this.SPI),this.transmissionActive=!1},o),!0}),s.writeHooks[n]=(t=>{this.cpu.data[n]=t,this.cpu.clearInterruptByFlag(this.SPI,t)})}reset(){this.transmissionActive=!1,this.receivedByte=0}get isMaster(){return!!(this.cpu.data[this.config.SPCR]&e)}get dataOrder(){return this.cpu.data[this.config.SPCR]&s?"lsbFirst":"msbFirst"}get spiMode(){return(this.cpu.data[this.config.SPCR]&c?2:0)|(this.cpu.data[this.config.SPCR]&r?1:0)}get clockDivider(){const t=this.cpu.data[this.config.SPSR]&d?2:4;switch(this.cpu.data[this.config.SPCR]&o){case 0:return t;case 1:return 4*t;case 2:return 16*t;case 3:return 32*t}throw new Error("Invalid divider value!")}get spiFrequency(){return this.freqHz/this.clockDivider}}exports.AVRSPI=S;
},{}],"rLPZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AVRClock=exports.clockConfig=void 0;const e=128,c={CLKPR:97};exports.clockConfig=c;const s=[1,2,4,8,16,32,64,128,256,2,4,8,16,32,64,128];class t{constructor(t,l,i=c){this.cpu=t,this.baseFreqHz=l,this.config=i,this.clockEnabledCycles=0,this.prescalerValue=1,this.cyclesDelta=0,this.cpu.writeHooks[this.config.CLKPR]=(c=>{if((!this.clockEnabledCycles||this.clockEnabledCycles<t.cycles)&&c===e)this.clockEnabledCycles=this.cpu.cycles+4;else if(this.clockEnabledCycles&&this.clockEnabledCycles>=t.cycles){this.clockEnabledCycles=0;const e=15&c,l=this.prescalerValue;this.prescalerValue=s[e],this.cpu.data[this.config.CLKPR]=e,l!==this.prescalerValue&&(this.cyclesDelta=(t.cycles+this.cyclesDelta)*(l/this.prescalerValue)-t.cycles)}return!0})}get frequency(){return this.baseFreqHz/this.prescalerValue}get prescaler(){return this.prescalerValue}get timeNanos(){return(this.cpu.cycles+this.cyclesDelta)/this.frequency*1e9}get timeMicros(){return(this.cpu.cycles+this.cyclesDelta)/this.frequency*1e6}get timeMillis(){return(this.cpu.cycles+this.cyclesDelta)/this.frequency*1e3}}exports.AVRClock=t;
},{}],"tbbQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e={CPU:!0,avrInstruction:!0,avrInterrupt:!0,AVRTimer:!0,timer0Config:!0,timer1Config:!0,timer2Config:!0,AVRIOPort:!0,portAConfig:!0,portBConfig:!0,portCConfig:!0,portDConfig:!0,portEConfig:!0,portFConfig:!0,portGConfig:!0,portHConfig:!0,portJConfig:!0,portKConfig:!0,portLConfig:!0,PinState:!0,AVRUSART:!0,usart0Config:!0,AVREEPROM:!0,EEPROMMemoryBackend:!0,eepromConfig:!0,spiConfig:!0,AVRSPI:!0,AVRClock:!0,clockConfig:!0};Object.defineProperty(exports,"CPU",{enumerable:!0,get:function(){return r.CPU}}),Object.defineProperty(exports,"avrInstruction",{enumerable:!0,get:function(){return t.avrInstruction}}),Object.defineProperty(exports,"avrInterrupt",{enumerable:!0,get:function(){return n.avrInterrupt}}),Object.defineProperty(exports,"AVRTimer",{enumerable:!0,get:function(){return o.AVRTimer}}),Object.defineProperty(exports,"timer0Config",{enumerable:!0,get:function(){return o.timer0Config}}),Object.defineProperty(exports,"timer1Config",{enumerable:!0,get:function(){return o.timer1Config}}),Object.defineProperty(exports,"timer2Config",{enumerable:!0,get:function(){return o.timer2Config}}),Object.defineProperty(exports,"AVRIOPort",{enumerable:!0,get:function(){return i.AVRIOPort}}),Object.defineProperty(exports,"portAConfig",{enumerable:!0,get:function(){return i.portAConfig}}),Object.defineProperty(exports,"portBConfig",{enumerable:!0,get:function(){return i.portBConfig}}),Object.defineProperty(exports,"portCConfig",{enumerable:!0,get:function(){return i.portCConfig}}),Object.defineProperty(exports,"portDConfig",{enumerable:!0,get:function(){return i.portDConfig}}),Object.defineProperty(exports,"portEConfig",{enumerable:!0,get:function(){return i.portEConfig}}),Object.defineProperty(exports,"portFConfig",{enumerable:!0,get:function(){return i.portFConfig}}),Object.defineProperty(exports,"portGConfig",{enumerable:!0,get:function(){return i.portGConfig}}),Object.defineProperty(exports,"portHConfig",{enumerable:!0,get:function(){return i.portHConfig}}),Object.defineProperty(exports,"portJConfig",{enumerable:!0,get:function(){return i.portJConfig}}),Object.defineProperty(exports,"portKConfig",{enumerable:!0,get:function(){return i.portKConfig}}),Object.defineProperty(exports,"portLConfig",{enumerable:!0,get:function(){return i.portLConfig}}),Object.defineProperty(exports,"PinState",{enumerable:!0,get:function(){return i.PinState}}),Object.defineProperty(exports,"AVRUSART",{enumerable:!0,get:function(){return p.AVRUSART}}),Object.defineProperty(exports,"usart0Config",{enumerable:!0,get:function(){return p.usart0Config}}),Object.defineProperty(exports,"AVREEPROM",{enumerable:!0,get:function(){return u.AVREEPROM}}),Object.defineProperty(exports,"EEPROMMemoryBackend",{enumerable:!0,get:function(){return u.EEPROMMemoryBackend}}),Object.defineProperty(exports,"eepromConfig",{enumerable:!0,get:function(){return u.eepromConfig}}),Object.defineProperty(exports,"spiConfig",{enumerable:!0,get:function(){return c.spiConfig}}),Object.defineProperty(exports,"AVRSPI",{enumerable:!0,get:function(){return c.AVRSPI}}),Object.defineProperty(exports,"AVRClock",{enumerable:!0,get:function(){return g.AVRClock}}),Object.defineProperty(exports,"clockConfig",{enumerable:!0,get:function(){return g.clockConfig}});var r=require("./cpu/cpu"),t=require("./cpu/instruction"),n=require("./cpu/interrupt"),o=require("./peripherals/timer"),i=require("./peripherals/gpio"),p=require("./peripherals/usart"),u=require("./peripherals/eeprom"),f=require("./peripherals/twi");Object.keys(f).forEach(function(r){"default"!==r&&"__esModule"!==r&&(Object.prototype.hasOwnProperty.call(e,r)||r in exports&&exports[r]===f[r]||Object.defineProperty(exports,r,{enumerable:!0,get:function(){return f[r]}}))});var c=require("./peripherals/spi"),g=require("./peripherals/clock");
},{"./cpu/cpu":"F3UQ","./cpu/instruction":"cvTP","./cpu/interrupt":"DZzW","./peripherals/timer":"eu9G","./peripherals/gpio":"X0BL","./peripherals/usart":"Iff3","./peripherals/eeprom":"niNh","./peripherals/twi":"PbiE","./peripherals/spi":"XwuY","./peripherals/clock":"rLPZ"}],"rACS":[function(require,module,exports) {
"use strict";function s(s,t){for(const e of s.split("\n"))if(":"===e[0]&&"00"===e.substr(7,2)){const s=parseInt(e.substr(1,2),16),r=parseInt(e.substr(3,4),16);for(let o=0;o<s;o++)t[r+o]=parseInt(e.substr(9+2*o,2),16)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadHex=s;
},{}],"HrFm":[function(require,module,exports) {
"use strict";var t=i(require("avr8js")),e=require("./intelhex");function r(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(r=function(t){return t?i:e})(t)}function i(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var i=r(e);if(i&&i.has(t))return i.get(t);var s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var a=o?Object.getOwnPropertyDescriptor(t,n):null;a&&(a.get||a.set)?Object.defineProperty(s,n,a):s[n]=t[n]}return s.default=t,i&&i.set(t,s),s}class s{constructor(t,e){this.frameId,this.cpu,this.timer0,this.portA,this.portB,this.portC,this.portD,this.program=new Uint16Array,this.clockFrequency=16e6,this.flashSize=32768,this.leds=t,this.button=e}loadGame(r){const i=new Uint8Array(this.flashSize/2);(0,e.loadHex)(r,i),this.program=new Uint16Array(i.buffer),this.cpu=new t.CPU(this.program),this.timer0=new t.AVRTimer(this.cpu,t.timer0Config),this.initPorts()}initPorts(){this.portA=new t.AVRIOPort(this.cpu,t.portAConfig),this.portB=new t.AVRIOPort(this.cpu,t.portBConfig),this.portC=new t.AVRIOPort(this.cpu,t.portCConfig),this.portD=new t.AVRIOPort(this.cpu,t.portDConfig),this.portA.addListener(()=>{this.ledHandler("portA")}),this.portB.addListener(()=>{this.ledHandler("portB")}),this.portC.addListener(()=>{this.ledHandler("portC")}),this.portD.addListener(()=>{this.ledHandler("portD")})}ledHandler(e){const r=this.leds.filter(t=>t.avrPort==e);for(let i of r)this[e].pinState(i.avrPin)!==t.PinState.High?(i.domElement.classList.remove("on"),i.domElement.classList.add("off"),i.state=!1):(i.domElement.classList.remove("off"),i.domElement.classList.add("on"),i.state=!0)}executeGame(){const e=this.cpu.cycles+this.clockFrequency/60;for(;this.cpu.cycles<=e;)t.avrInstruction(this.cpu),this.cpu.tick();this.frameId=requestAnimationFrame(()=>this.executeGame())}stopGame(){cancelAnimationFrame(this.frameId);for(let t of this.leds)t.state&&(t.domElement.classList.remove("on"),t.domElement.classList.add("off"),t.state=!1)}}window.Emulator=s;
},{"avr8js":"tbbQ","./intelhex":"rACS"}]},{},["HrFm"], null)
//# sourceMappingURL=/emulator.js.map